<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
   
    <title>
    Users Admin - TradinGo
    </title>
    <link rel="stylesheet" href="specialstyle.css">

    <script src="
    https://cdn.jsdelivr.net/npm/sweetalert2@11.7.1/dist/sweetalert2.all.min.js
    "></script>
    <link href="
    https://cdn.jsdelivr.net/npm/sweetalert2@11.7.1/dist/sweetalert2.min.css
    " rel="stylesheet">
    
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
        
<!--- header ni boy --->
<div class="container">
    <div class="navbar">
        <div>
            <!---logo put maya here --->
            <img src="LogoForNavBar.png"  width="125px" >
        </div>
        <nav>
            <ul id="MenuItems">
                <li><a href="AdminPanel.html">Users</a></li>
                <li><a href="ProductAdmin.html">Products</a></li>
                <li><a href="ActivityRep.html">Activity</a></li>
                <li><a href="TransActions.html">Transactions</a></li>
                <li><a href="ReportPage.html">Reports</a></li>
                <li><a href="" id="LogOut" style="color: red;">Logout</a></li>
            </ul>
        </nav>
        
</div>

</head>

<style>

    .detbtns{
    display: inline-block;
    background: red;
    color: #fff;
    padding: 8px 20px;
    margin: 30px 0;
    transition: background 0.5s;
    border-radius: 12px;
 
}
.delbtnz{
  display: inline-block;
    background: green;
    color: #fff;
    padding: 8px 20px;
    margin: 30px 0;
    transition: background 0.5s;
    border-radius: 12px;
}
.productcard {
  background-color: rgba(255, 255, 255, 0.10);
  border-radius: 4px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-direction: row;
  padding: 20px;
  width: max-content;
  gap: 5px; /* Adjust the spacing as needed */
}

.productcard > :first-child {
  margin-left: 20px; 
}
.productcard > :nth-child(2) {
  margin-left: 32px; /* Adjust the margin as needed */
}


.PTagDv {
  margin: 0 100px;
  padding-bottom: 10px;
}

.table-container {
  overflow-x: auto;
}

table {
  overflow: hidden;
  width: 100%;
  table-layout: fixed;
  border-collapse: separate;
  border-spacing: 1px; /* Adjust the spacing as needed */
}

td {
  width: 175px; /* Adjust the width as needed */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  padding: 10px;
}

td input {
  width: 100%;
  box-sizing: border-box;
  padding: 8px;
}



.PfpImg {
    height: 100px;
    width: 100px;
    border-radius: 100%;
    border: 5px solid #fff;
}
</style>
<body>
  

    <table class="table" border="2" style="border-collapse:collapse;">



        <button id="EditBtn" class="Edit btn">Edit</button>
        



        <thead>
          <tr>
     
            <th>Avatar</th>
            <th>Email</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Contact Number</th>
            <th>Bio</th>
            <th>Action</th>
        

          </tr>
        </thead>
      
        <tbody id="productsDiv" class="container"> 
         

        </tbody>
   
      </table>

        <script>
            var MenuItems = document.getElementById("MenuItems");
        
            MenuItems.style.maxHeight = "0px";
        
            function menutoggle(){
                if(MenuItems.style.maxHeight == "0px"){
                    MenuItems.style.maxHeight = "200px";
                }
                else{
                    MenuItems.style.maxHeight = "0px";
                }
            }
        </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

<script type="module">




let IdArray = [];
let userUid;
let DisplayName;

// Edit Button func
let buttonClicked = false;
document.getElementById('EditBtn').addEventListener('click', function() {
   
   

buttonClicked = !buttonClicked;
   /*
   let originalId = td.id; 
 IdArray.push(originalId);
 console.log(IdArray);
   */

 
  if (buttonClicked) {

const tds = document.querySelectorAll('td');


for (let i = 0; i < tds.length; i++) {
 
  const id = tds[i].getAttribute('id');
  const cls = tds[i].getAttribute('class');

  const input = document.createElement('input');
  
  console.log(cls);
  
  input.className = cls;
  input.type = 'text';
  input.value = tds[i].innerText;
  input.id = id;
  
  tds[i].parentNode.replaceChild(input, tds[i]);
}
$(".detbtns").hide();
$(".delbtnz").hide();
$(".PTagDv").show();


  } else {

const inputs = document.querySelectorAll('input');

inputs.forEach(input => {
  
  const td = document.createElement('td');
 
  td.id = input.id;
  td.className = input.className;

  
  td.textContent = input.value;

  input.parentNode.replaceChild(td, input);
});

$(".detbtns").show();
$(".delbtnz").show();
$(".PTagDv").hide();

  }

});
  
//imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";

const firebaseConfig = {
    apiKey: "AIzaSyB9XhRzkpjkyuAZLaMSxaLQJs7DwwNESmY",
    authDomain: "tradingo-824d6.firebaseapp.com",
    databaseURL: "https://tradingo-824d6-default-rtdb.firebaseio.com",
    projectId: "tradingo-824d6",
    storageBucket: "tradingo-824d6.appspot.com",
    messagingSenderId: "273813724823",
    appId: "1:273813724823:web:5af639aa92782227fe53d2",
    measurementId: "G-K74SN99P90"
  };

  const app = initializeApp(firebaseConfig);

  import { getAuth, signInWithEmailAndPassword,  signOut, updateProfile, sendSignInLinkToEmail, onAuthStateChanged }
   from "https://www.gstatic.com/firebasejs/9.13.0/firebase-auth.js";

   import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-analytics.js";

  import { getStorage, ref as sRef, uploadBytesResumable, getDownloadURL}
  from"https://www.gstatic.com/firebasejs/9.13.0/firebase-storage.js"

  import { getDatabase, get,child, set, ref, update, remove, onValue}
   from "https://www.gstatic.com/firebasejs/9.13.0/firebase-database.js";

 const realdb = getDatabase();
  const dbref = ref(realdb);
    const auth = getAuth(app);

    LogOut.addEventListener('click', (e) => {
const auth = getAuth();
signOut(auth).then(() => {
    window.location.href = "LoginPage.html";
}).catch((error) => {
  // An error happened.
});
});


var OuterDiv = document.getElementById('productsDiv');
var ArrayOfProducts = [];
let myArray = [];

const starCountRef = ref(realdb, 'users/');
onValue(starCountRef, (snapshot) => {
  const data = snapshot.val();
//console.log(data);
});

window.addEventListener('load', GetAllProducts);

function GetAllProducts() {
      
 //console.log(userUid);
    get(child(dbref, 'users'))
    .then((snapshot) =>{
//console.log((child(dbref, 'users/')));

let objString = JSON.stringify(snapshot.val());

       myArray.push(objString); 

        snapshot.forEach(prod =>{
ArrayOfProducts.push(prod.val());
        });
      

        AddAllProducts();
    })

}

function AddAllProducts(){
    let i = 0;

    ArrayOfProducts.forEach(prod =>{
AddAProduct(prod, i++);
    });
    AssignAllEvents();
    AssignEvents();
}


function AddAProduct(Users, index) {
  let Fname = Users.First_Name;
  let Lname = Users.Last_Name;

  let contnum = Users.contnum ? Users.contnum : ''; // Check if contnum is defined and assign a blank space if not
  let bio = Users.bio ? Users.bio : ''; // Check if bio is defined and assign a blank space if not

  let html = 
  `
  <img src="${Users.Pfp}" class="PfpImg" id="PfpImg-${index}">
   <td class="email" id="email-${index}">${Users.email}</td>
  <td class="Fname" id="Fname-${index}">${Fname}</td>
  <td class="Lname" id="Lname-${index}">${Lname}</td>
  <td class="contnum" id="contnum-${index}">${contnum}</td>
  <td class="bio" id="bio-${index}">${bio}</td>


    <button class="detbtns" id="Delbtn-${index}">Save</button>
    <button class="delbtnz" id="Delbtn-${index}">Delete</button>

  `;

  let newProd = document.createElement("tr");
  newProd.classList.add('productcard');
  newProd.innerHTML = html;
  OuterDiv.append(newProd);
}


function GetProductIndex(id){
    var indstart = id.indexOf('-') + 1;
    var indend = id.length;
    return Number(id.substring(indstart, indend));
}

function accept(event){

console.log("OSHET MINECRAFT");
var index = GetProductIndex(event.target.id);
localStorage.Product = JSON.stringify(ArrayOfProducts[index]);
console.log(localStorage.Product); 
let product = localStorage.Product;
            product=JSON.parse(product);
console.log(index);

/*
   <td class="email" id="email-${index}">${Users.email}</td>
  <td class="Fname" id="Fname-${index}">${Fname}</td>
  <td class="Lname" id="Lname-${index}">${Lname}</td>
  <td class="contnum" id="contnum-${index}">${contnum}</td>
  <td class="bio" id="bio-${index}">${bio}</td>
*/

let emailVar;
let FnameVar;
let LnameVar;
let contnumVar;
let bioVar;


 let emailInp = document.getElementById("email-" + index);
 let FnameInp = document.getElementById("Fname-" + index);
 let LnameInp = document.getElementById("Lname-" + index);
 let contnumInp = document.getElementById("contnum-" + index);
 let bioInp = document.getElementById("bio-" + index);


 emailVar = emailInp.textContent;
 FnameVar = FnameInp.textContent;
 LnameVar = LnameInp.textContent;
 contnumVar = contnumInp.textContent;
 bioVar = bioInp.textContent;

 
 

//add pa admin login tanga ka kaseh

let adminUid = "uQui4AOFERZCqeIY6euTmo4PeB93";
let ActType = "Edited User" 
let randomString = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);

const currentDate = new Date();
const formattedDate = currentDate.toISOString().slice(0, 19).replace('T', ' ');

update(ref(realdb,'AdminActivity/' + randomString),{ //mao ni si sender
    ActivityType: ActType,
    Admin: adminUid,
TimeDate:formattedDate,
Edited:product.UserUid
    });

    let User = product.UserUid;
let pota = "yasheshwa";

update(ref(realdb,'users/' + User ),{ //mao ni si sender
email: emailVar,
First_Name:FnameVar,
Last_Name:LnameVar,
contnum:contnumVar,
bio:bioVar
    }).then(() => {
    
        Swal.fire('Update success!');
       
      })

}


//para kung reject
function reject(event){
console.log("NoSHet MINECRAFT");
var index = GetProductIndex(event.target.id);
localStorage.Product = JSON.stringify(ArrayOfProducts[index]);
console.log(localStorage.Product);
let product = localStorage.Product;
            product=JSON.parse(product);

            let User = product.UserUid;


//add pa admin login tanga ka kaseh

let adminUid = "uQui4AOFERZCqeIY6euTmo4PeB93";
let ActType = "Deleted User" 
let randomString = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);

const currentDate = new Date();
const formattedDate = currentDate.toISOString().slice(0, 19).replace('T', ' ');

update(ref(realdb,'AdminActivity/' + randomString),{ //mao ni si sender
    ActivityType: ActType,
    Admin: adminUid,
TimeDate:formattedDate,
Deleted:product.UserUid
    });

remove(child(dbref, 'users/' + User))
   .then((snapshot) =>{
       setTimeout(function() {
  console.log("3 seconds have passed.");
  window.location.reload();
}, 3000);
       
       });
  
}

function AssignAllEvents(){
    var btns = document.getElementsByClassName("detbtns");
    var titles = document.getElementsByClassName("titleProd");
   
 
for (let i = 0; i < btns.length; i++){
    btns[i].addEventListener('click', accept);
   
}
}

function AssignEvents(){
    var btnz = document.getElementsByClassName("delbtnz");
    var titles = document.getElementsByClassName("titleProd");
   
 
for (let i = 0; i < btnz.length; i++){
    btnz[i].addEventListener('click', reject);
}
}
</script>

</body>
</html>