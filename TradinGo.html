<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.15.5/firebase-database.js"></script>
    <meta charset="UTF-8">
   
    <title>
     TradinGo | Ormoc
    </title>
    <link rel="stylesheet" href="style.css">
    <div class="header">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
</head>
<body>
<!--- header ni boy --->
<div class="container">
<div class="navbar">
    <div class="ImgNav">
        <!---logo put maya here --->
        <img src="images/LogoForNavBar.png"  width="125px" >

        <div class="input-container">
            <input type="text" id="myInput" class="inputBox">
            <i class="fa fa-search"></i>
            <div class="square" id="square"></div>
          </div>
    </div>
    <nav>
        <ul id="MenuItems">
            <li><a href="TradinGo.html">Home</a></li>
            <li><a href="products.html">Products</a></li>
           <li><a href="Profile.html">Profile</a></li>
           <li><a href="MessageList.html">Messages</a></li>         
          
            <li><a href="about.html">About</a></li>

        </ul>
    </nav>
    <div class="carticonPad">
        <img src="images/cartIcon.png" id="TradeIcon" width="40px" height="40px">    
        <div id="circle"></div>
    
    </div>
    <i id="BellIcon" class="fa fa-bell" style="font-size:23px"></i>
    <div id="circle2"></div>
    <img src="images/menu.png" class="menu-icon" onclick="menutoggle()">
     </div>
   
 <div class="row">
    <div class="col-2">
        <h1>TradinGo<br>Ormoc city's<br>Hub</h1>
        <p>
            Trade locally<br>Buy locally<br>With TradinGo
        </p>
        <a href="products.html" class="btn">Explore now &#8594;</a>
    </div>
    <div class="col-2">
        <div class="image-container">
              <img src="images/head.png">
        </div>
   
    </div>  
 </div>
</div>
</div>
<style>
    .image-container {
  position: relative;
  height: 600px; /* Adjust the height to your desired value */
  overflow: hidden;
}

.image-container img {
  position: absolute;
  animation: moveUpDown 2s infinite alternate;
}

@keyframes moveUpDown {
  0% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(-50px); /* Adjust the distance to your desired value */
  }
}

    .ProdBar {
    width: 500px;
    height: 65px;
    background-color: rgb(255, 255, 255);
    margin: 3px !important;
    border-radius: 10px;
    border: #000 solid 1px;
}
   .title::after {
    content: '';
    background: #ff523b;
    width: 0px !important;
    height: 0px !important;
    border-radius: 5px;
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
}
           #productsDiv{
                display: flex;
    flex-wrap: wrap;
    padding-left: 160px;
    padding-bottom: 100px;
            }
            
                .productcard{
                    border: 1px black solid;
                    height: 430px;
            width: 300px;
                    margin: 20px;
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    flex-direction: column;
                    border-radius: 10px;
                    transition: border-color .3s;
                    padding: 10px;
                }
                .productcard:hover{
                    border-color: rgb(233, 68, 68);
                }
                .thumb{
                    width: 260px;
                    height: 160px;
                    cursor: pointer;
                }
                .detbtns{
                    background-color: #fc6f25;
                    color: black;
                    margin-bottom: 15px;
                }
                .detbtns:hover{
                    background-color: wheat;
                }
                .title{
                    font-size: 16;
                    font-weight: bold;
                    cursor: pointer;
                    padding-left: 5px;
                    width: 100%;
                    padding-right: 5px;
                    text-align: center; 
            }
            .points{
                align-self: flex-start;
                word-wrap: break-word;
                height: 192px;
            }
            .inputBox{
                padding: 5px;
                border-radius: 5px;
                border-width: 1px;
                border: 1px solid #ff523b;
                transition: width 0.3s ease-in-out;
                width: 200px;
            }
            .square{
                transition: width 0.3s ease-in-out;
                width: 508px; 
    }
            .inputBox:focus-within {
                width: 515px;
}
        
            .input-container {
  position: relative;
  flex-direction: column;
  align-items: center;
  width: max-content;
}

.input-container input {
  padding-right: 30px; /* adjust this value as needed to make room for the icon */
      padding: 7px;
}

.input-container i {
  position: absolute;
  top: 50%;
  right: 10px;
  transform: translateY(-50%);
}
.carticonPad {
  display: inline-flex;
  align-items: center;
  margin-left: 15px;
  margin-right: 1px;
}

.carticonPad #circle {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background-color: red;
  margin-left: 5px;
  display: none;
}
#circle2 {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background-color: red;
  margin-left: 5px;
  display: none;
}
    </style>
<!-- tradeable --->
<h2 class="title">Tradeable Products</h2>

</div>
<div id="productsDiv" class="container">
     



</div>




<!--footer-->
<div class="footer">
    <div class="container">
        <div class="row">
            <div class="footer-col-1">
                <h3>Download our app</h3>
                <p>Download our app now available on android.</p>
                <div class="app-logo">
                    <img src="images/play-store.png">
                </div>
            </div>
            <div class="footer-col-2">
                <img src="images/FooterI_log.png">
                <p>Our purpose is to provide a platform for the citizens of Ormoc city to be able to trade and shop locally.</p>
            </div>
            <div class="footer-col-3">
                <h3>Useful links</h3>
               <ul>
                <li>Coupons</li>
                <li>Blog Post</li>
                <li>Retrun Policy</li>
                <li>Join Affiliate</li>
               </ul>
            </div>
            <div class="footer-col-4">
                <h3>Follow us on</h3>
               <ul>
                <li>Facebook</li>
                <li>Instagram</li>
                <li>Twitter</li>
                <li>Youtube</li>
               </ul>
            </div>
        </div>
        <hr>
        <p class="copyright">Copyright 2022 - TradinGo</p>
    </div>
</div>

<!--Toggle for js menu shits-->
<script>
    var MenuItems = document.getElementById("MenuItems");

    MenuItems.style.maxHeight = "0px";

    function menutoggle(){
        if(MenuItems.style.maxHeight == "0px"){
            MenuItems.style.maxHeight = "600px";
        }
        else{
            MenuItems.style.maxHeight = "0px";
        }
    }
</script>

<script type="module">
let userId;

function getShortTitle(title) {
  if (title.length > 19)
    return title.substring(0, 19) + "...";
  else
    return title;
}


//imports
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";

const firebaseConfig = {
    apiKey: "AIzaSyB9XhRzkpjkyuAZLaMSxaLQJs7DwwNESmY",
    authDomain: "tradingo-824d6.firebaseapp.com",
    databaseURL: "https://tradingo-824d6-default-rtdb.firebaseio.com",
    projectId: "tradingo-824d6",
    storageBucket: "tradingo-824d6.appspot.com",
    messagingSenderId: "273813724823",
    appId: "1:273813724823:web:5af639aa92782227fe53d2",
    measurementId: "G-K74SN99P90"
  };

  const app = initializeApp(firebaseConfig);

  import { getDatabase, set, ref, child, get, update}
   from "https://www.gstatic.com/firebasejs/9.13.0/firebase-database.js";

   import { getAuth, signInWithEmailAndPassword,  signOut, updateProfile, sendSignInLinkToEmail, onAuthStateChanged }
   from "https://www.gstatic.com/firebasejs/9.13.0/firebase-auth.js";

   const realdb = getDatabase();
   const auth = getAuth(app);

//detect slow connection 



var OuterDiv = document.getElementById('productsDiv');
var OuterDiv2 = document.getElementById('square');
var ArrayOfProducts = [];
window.addEventListener('load', GetAllProducts);

function GetAllProducts() {

    const dbref = ref(realdb);

    get(child(dbref,"Products/"))
    .then((snapshot) =>{
        
        snapshot.forEach(prod =>{
            
ArrayOfProducts.push(prod.val());
        });
      
 AddAllProducts();
 AddAllProducts2();

        
    })
}

//detect user has notif
onAuthStateChanged(auth, (user) => {
    const dbref = ref(realdb);

let userId = user.uid;
 console.log(userId);

 get(child(dbref, 'users/' + userId + '/Notification' ))
    .then((snapshot) =>{
       // console.log(snapshot.val());
        if(snapshot.val() === null){
            //console.log('Potangina');
        }else{  
           // console.log('yawa');
           var circle2 = document.getElementById("circle2");
circle2.style.display = "block"; /* show the circle */

        }
    })

    get(child(dbref, 'users/' + userId + '/Trades' + '/Pending_Trade' ))
    .then((snapshot) =>{
        console.log(snapshot.val());
        if(snapshot.val() === null){
            console.log('shesh par');
        }else{
            console.log('erp erp par');
            var circle = document.getElementById("circle");
circle.style.display = "block"; /* show the circle */

        }
    })

})

document.getElementById('TradeIcon').addEventListener('click', function() {
 
 onAuthStateChanged(auth, (user) => {
 if (user  == null) {
   window.location = 'account.html';
 } else {
  window.location = 'Transactions.html';
 }
});
});


document.getElementById('BellIcon').addEventListener('click', function() {
 onAuthStateChanged(auth, (user) => {
 if (user  == null) {
   window.location = 'account.html';
 } else {
  window.location = 'Notifications.html';
 }
});
});


function AddAllProducts(){
    let i = 0;

    ArrayOfProducts.forEach(prod =>{
AddAProduct(prod, i++);
    });
    AssignAllEvents();
}

function AddAllProducts2(){
    let i = 0;

    ArrayOfProducts.forEach(prod =>{
AddAProduct2(prod, i++);
    });
    AssignAllEvents();
}

function AddAProduct(product, index){
   
              let html = 
    `
    <img src="`+ product.LinksOfImgsArray[0] +`" class="thumb mt-2" id="thumb-`+ index +`">
        <p class="title" id="title-`+ index+`"> `+ getShortTitle(product.ProductTitle) +` </p>
       `+ 
       
       
       GenerateStockLabel(product.Stock)

       +
       `
        <h5 class="price">Market Value â‚±`+ product.Price +` </h5>
        <button class="detbtns btn" id="detbtn-`+ index +`">View details</button>
    `
    if (index < 3){
    let newProd = document.createElement("div");
    newProd.classList.add('productcard');
    newProd.innerHTML = html;
    OuterDiv.append(newProd);   
}

}


function AddAProduct2(product, index){
   
   let html = 
`

<p class="title" id="title-`+ index+`"> `+ getShortTitle(product.ProductTitle) +` </p>


`


let newProd2 = document.createElement("div");
newProd2.classList.add('ProdBar');
newProd2.innerHTML = html;
OuterDiv2.append(newProd2);   

newProd2.querySelector('.title').addEventListener('click', GoToProductDetails);


let box = document.getElementById("square");
let productcard = document.getElementsByClassName("ProdBar");
let pota = document.getElementById("myInput");   

pota.addEventListener("input", function() {
let myArray = [];

//get sa value ni input

var inputText = document.getElementById("myInput").value;
        

var lowerCaseText = inputText.toLowerCase();

//var input = document.getElementById("myInput");
//var umay = input.toLowerCase();

var value = lowerCaseText;

const words = product.ProductTitle.split(" ");
const aWords = words.filter(word => word.charAt(0).toLowerCase() === value);
const result = aWords.join(" ");
myArray.push(product.ProductTitle);
//console.log(myArray.includes(value));
const filteredWords = myArray.filter(word => {
return word.includes(value);
});
//console.log(filteredWords);

if(product.ProductTitle == result || product.ProductTitle == value || product.ProductTitle == filteredWords)
{
productcard[index].style.display= "";


}
else{
productcard[index].style.display= "none";

}

 // detect click on search bar
 pota.addEventListener('click', function(event) {
    event.stopPropagation();
    box.style.display = "block";
  });
  
  // detect click outside search bar
  document.addEventListener('click', function(event) {
    if (event.target !== pota) {
      box.style.display = "none";
    }
  });

});

}

//detect click search bar
document.getElementById('myInput').addEventListener('click', function() {
  let box = document.getElementById("square");
  event.stopPropagation();
  box.style.display = "block";
});



function GenerateStockLabel(stock){
let stocklabel = document.createElement('h5');
stocklabel.classList.add('stock');

if (stock > 0){
    stocklabel.innerHTML='In stock';
    stocklabel.classList.add('text-success');
}
else{
    stocklabel.innerHTML='Out of stock';
    stocklabel.classList.add('text-warning');
}
return stocklabel.outerHTML;
}

function GetProductIndex(id){
    var indstart = id.indexOf('-') + 1;
    var indend = id.length;
    return Number(id.substring(indstart, indend));
}

function GoToProductDetails(event){
   
var index = GetProductIndex(event.target.id);
 console.log(index);
localStorage.Product = JSON.stringify(ArrayOfProducts[index]);
window.location = "products-details.html";
}

function AssignAllEvents(){
    var btns = document.getElementsByClassName("detbtns");
    var titles = document.getElementsByClassName("title");
    var thumbs = document.getElementsByClassName("thumb");
 
for (let i = 0; i < btns.length; i++){
    btns[i].addEventListener('click', GoToProductDetails);
    titles[i].addEventListener('click', GoToProductDetails);
    thumbs[i].addEventListener('click', GoToProductDetails);
}
}
</script>


</body>
</html>
